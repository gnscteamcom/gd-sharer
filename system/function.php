<?php  function load($url) { $ch = curl_init(); curl_setopt($ch, CURLOPT_AUTOREFERER, TRUE); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, TRUE); $data = curl_exec($ch); curl_close($ch); return $data; } function config($key) { $file = file_get_contents("base/data/setting/config.json"); $deco = json_decode($file, true); $conf = $deco[$key]; return $conf; } function head_content() { $id = config('google.webmaster.id'); if(!empty($id)) { $content = "<meta name=\"google-site-verification\" content=\"$id\" />"; } return $content; } function analytics() { $id = config('google.analytics.id'); if(!empty($id)) { $content = "
			<script>
				(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

				ga('create', '$id', 'auto');
				ga('send', 'pageview');
			</script>"; } return $content; } function token($type,$refresh) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, "https://www.googleapis.com/oauth2/v4/token"); curl_setopt($ch, CURLOPT_POST, 1); if($type == "code") { curl_setopt($ch, CURLOPT_POSTFIELDS, "code=$refresh&redirect_uri=".config('drive.redirect.uris')."&client_id=".config('drive.client.id')."&client_secret=".config('drive.client.secret')."&grant_type=authorization_code" ); } else if($type == "refresh") { if($refresh) { $user = json_decode(file_get_contents("base/data/user/$refresh.json"),true); } curl_setopt($ch, CURLOPT_POSTFIELDS, "client_secret=".config('drive.client.secret')."&grant_type=refresh_token&refresh_token=$user[refresh_token]&client_id=".config('drive.client.id')."" ); } curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $result = curl_exec($ch); curl_close($ch); return json_decode($result, true); } function anyone($id,$token) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, "https://www.googleapis.com/drive/v3/files/$id/permissions?key=$token"); curl_setopt($ch, CURLOPT_HTTPHEADER, array("Content-type: application/json", "Authorization: Bearer $token", "{\"role\":\"reader\",\"type\":\"anyone\"}")); curl_setopt($ch, CURLOPT_POST, 1); curl_setopt($ch, CURLOPT_POSTFIELDS, "{\"role\":\"reader\",\"type\":\"anyone\"}"); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $result = curl_exec($ch); curl_close($ch); } function copyfile($id,$token) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, "https://www.googleapis.com/drive/v3/files/$id/copy?access_token=$token"); curl_setopt($ch, CURLOPT_HTTPHEADER, array("Content-length: 0", "Content-type: application/json", "Authorization: Bearer $token")); curl_setopt($ch, CURLOPT_POST, 1); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $result = curl_exec($ch); curl_close($ch); return json_decode($result, true); } function delete($id,$token) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL,"https://www.googleapis.com/drive/v3/files/$id?key=$token"); curl_setopt($ch, CURLOPT_HTTPHEADER, array("Authorization: Bearer $token")); curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "DELETE"); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $result = curl_exec($ch); curl_close($ch); } function menu_file($token,$next,$q) { $ch = curl_init(); curl_setopt($ch, CURLOPT_AUTOREFERER, TRUE); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_URL, "https://www.googleapis.com/drive/v3/files?q=fullText+contains+%27$q%27&pageSize=10&fields=files(fileExtension%2Cid%2Cname%2Csize%2CoriginalFilename)%2CnextPageToken&access_token=$token&pageToken=$next"); curl_setopt($ch, CURLOPT_FOLLOWLOCATION, TRUE); $data = curl_exec($ch); curl_close($ch); return json_decode($data, true); } function formatBytes($size, $precision = 2) { $base = log($size, 1024); $suffixes = array('', 'KB', 'MB', 'GB', 'TB'); return round(pow(1024, $base - floor($base)), $precision) .' '. $suffixes[floor($base)]; } function activity($user_id,$file_id,$title,$format,$size,$mime) { $date = date("d-M-Y H:i:s"); $folder = "base/data/main/user/$user_id"; if(is_null($id)) { $id = 1; } while(file_exists("base/data/main/share/$id.json")) { $id += 1; } if (!is_dir($folder)) { mkdir($folder, 0777, true); } $info = array( status => "publish", user_id => $user_id, file_id => $file_id, share_id => $id, date => $date, title => $title, format => $format, size => $size, poster => $poster, mime => $mime ); $format = array( "file" => $info ); file_put_contents("base/data/main/share/$id.json", json_encode($format)); file_put_contents("base/data/main/user/$user_id/$id.json", null); echo "
		<code><button class=\"zec\" style=\"border: none;background: none;padding: 0 5px;\" data-clipboard-demo=\"\" data-clipboard-action=\"copy\" data-clipboard-text=\"http://".config('site.domain')."/file/$id\"><span class=\"glyphicon glyphicon-link\" aria-hidden=\"true\"></span></button><a href=\"http://".config('site.domain')."/file/$id/code/true\">$title</a></code>"; return true; }